{
  "info": {
    "name": "SurveyBackend",
    "_postman_id": "7d8f5c6e-dced-4f8b-9c4d-2a18284d888f",
    "description": "Postman collection for Survey Backend API.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const jsonData = pm.response.json();",
                  "",
                  "if (jsonData && jsonData.accessToken) {",
                  "    pm.environment.set('token', jsonData.accessToken);",
                  "}",
                  "",
                  "if (jsonData && jsonData.refreshToken) {",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "}",
                  "",
                  "pm.test('Access token captured', function () {",
                  "    pm.expect(pm.environment.get('token')).to.be.ok;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"admin\",\n  \"password\": \"Passw0rd!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "login"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "const jsonData = pm.response.json();",
                  "if (jsonData && jsonData.accessToken) {",
                  "    pm.environment.set('token', jsonData.accessToken);",
                  "}",
                  "if (jsonData && jsonData.refreshToken) {",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/refresh",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "refresh"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Logout",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/logout",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "logout"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Auth Test",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/auth/test",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "test"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Update Admin Password",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newPassword\": \"N3wAdm1nPass!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/auth/admin/password",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "auth",
                "admin",
                "password"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Surveys",
      "item": [
        {
          "name": "Create Survey",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "let surveyId = null;",
                  "const locationHeader = pm.response.headers.get('Location');",
                  "if (locationHeader) {",
                  "    const parts = locationHeader.split('/').filter(Boolean);",
                  "    surveyId = parts[parts.length - 1];",
                  "}",
                  "",
                  "try {",
                  "    const jsonData = pm.response.json();",
                  "    if (!surveyId && jsonData && jsonData.id) {",
                  "        surveyId = jsonData.id;",
                  "    }",
                  "} catch (e) { /* ignore parse errors */ }",
                  "",
                  "if (surveyId) {",
                  "    pm.environment.set('surveyId', surveyId);",
                  "}",
                  "",
                  "pm.test('SurveyId captured when available', function () {",
                  "    pm.expect(pm.environment.get('surveyId')).to.be.ok;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Employee Satisfaction 2024\",\n  \"description\": \"Quarterly pulse check\",\n  \"accessType\": \"Internal\",\n  \"questions\": [\n    {\n      \"text\": \"How satisfied are you with your work environment?\",\n      \"type\": \"SingleSelect\",\n      \"order\": 1,\n      \"isRequired\": true,\n      \"options\": [\n        { \"text\": \"Very satisfied\", \"order\": 1, \"value\": 5 },\n        { \"text\": \"Satisfied\", \"order\": 2, \"value\": 4 },\n        { \"text\": \"Neutral\", \"order\": 3, \"value\": 3 },\n        { \"text\": \"Dissatisfied\", \"order\": 4, \"value\": 2 }\n      ]\n    },\n    {\n      \"text\": \"What should we improve?\",\n      \"type\": \"OpenText\",\n      \"order\": 2,\n      \"isRequired\": false,\n      \"options\": null\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/surveys",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "surveys"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Survey",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "try {",
                  "    const data = pm.response.json();",
                  "    if (data && Array.isArray(data.questions) && data.questions.length > 0) {",
                  "        pm.environment.set('questionId', data.questions[0].id);",
                  "    }",
                  "} catch (e) { /* ignore parse errors */ }"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/surveys/{{surveyId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "surveys",
                "{{surveyId}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Add Question",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"Would you recommend working here to a friend?\",\n  \"type\": \"SingleSelect\",\n  \"order\": 3,\n  \"isRequired\": true,\n  \"options\": [\n    { \"text\": \"Yes\", \"order\": 1, \"value\": 1 },\n    { \"text\": \"No\", \"order\": 2, \"value\": 0 }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/surveys/{{surveyId}}/questions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "surveys",
                "{{surveyId}}",
                "questions"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Publish Survey",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"startDate\": \"2024-09-01T00:00:00Z\",\n  \"endDate\": \"2024-10-01T00:00:00Z\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/surveys/{{surveyId}}/publish",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "surveys",
                "{{surveyId}}",
                "publish"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Participations",
      "item": [
        {
          "name": "Start Participation",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "let participationId = null;",
                  "try {",
                  "    const body = pm.response.json();",
                  "    if (typeof body === 'string') {",
                  "        participationId = body;",
                  "    } else if (body) {",
                  "        participationId = body.participationId || body.id;",
                  "    }",
                  "} catch (e) { /* ignore parse errors */ }",
                  "",
                  "if (participationId) {",
                  "    pm.environment.set('participationId', participationId);",
                  "}",
                  "",
                  "pm.test('ParticipationId captured when available', function () {",
                  "    pm.expect(pm.environment.get('participationId')).to.be.ok;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"surveyId\": \"{{surveyId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/participations/start",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "participations",
                "start"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Submit Answer",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"questionId\": \"{{questionId}}\",\n  \"textValue\": \"I appreciate the flexible hours.\",\n  \"optionIds\": [\"c199edc7-b2a0-4c1d-b0c1-1ef38f68c2e4\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/participations/{{participationId}}/answers",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "participations",
                "{{participationId}}",
                "answers"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Complete Participation",
          "request": {
            "method": "PATCH",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/participations/{{participationId}}/complete",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "participations",
                "{{participationId}}",
                "complete"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Management",
      "item": [
        {
          "name": "List Roles",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Role",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"DepartmentManager\",\n  \"description\": \"Can manage surveys for their department\",\n  \"permissions\": [\"ManageDepartment\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/roles",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "roles"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List Permissions",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/permissions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "permissions"
              ]
            }
          },
          "response": []
        },
        {
          "name": "List Departments",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/departments",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "departments"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Department Users",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/departments/{{departmentId}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "departments",
                "{{departmentId}}",
                "users"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Assign Role To User",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"7e95f2b3-2157-4f96-8cde-7644aa3c0f71\",\n  \"roleId\": \"c56a4180-65aa-42ec-a945-5fd21dec0538\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/departmentrole/assign",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "departmentrole",
                "assign"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Remove Role From User",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{token}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"7e95f2b3-2157-4f96-8cde-7644aa3c0f71\",\n  \"roleId\": \"c56a4180-65aa-42ec-a945-5fd21dec0538\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/departmentrole/remove",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "departmentrole",
                "remove"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "https://localhost:7123"
    },
    {
      "key": "token",
      "value": ""
    },
    {
      "key": "refreshToken",
      "value": ""
    },
    {
      "key": "surveyId",
      "value": ""
    },
    {
      "key": "participationId",
      "value": ""
    },
    {
      "key": "questionId",
      "value": ""
    },
    {
      "key": "departmentId",
      "value": ""
    }
  ],
  "protocolProfileBehavior": {}
}
